(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{260:function(e,t,r){e.exports=r(261)},261:function(e,t,r){"use strict";r.r(t);var n=r(5),s=r.n(n),a=r(273).default;console.log(a),window.nsUpdate=new s.a({el:"#update-app",components:{nsDatabaseUpdate:a}})},273:function(e,t,r){"use strict";r.r(t);var n=r(12),s=r.n(n),a=r(0);function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e,t,r,n,s,a,o){try{var i=e[a](o),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,s)}var u={name:"ns-database-update",data:function(){return{files:Update.files,returnLink:Update.returnLink,modules:Update.modules,updating:!1,xXsrfToken:null,updatingModule:!1,error:!1,lastErrorMessage:""}},mounted:function(){var e=this;a.nsHttpClient.get("/sanctum/csrf-cookie").subscribe((function(t){try{e.xXsrfToken=a.nsHttpClient.response.config.headers["X-XSRF-TOKEN"],e.proceedUpdate()}catch(e){a.nsSnackBar.error(e.message).subscribe()}}))},methods:{proceedUpdate:function(){var e,t=this;return(e=s.a.mark((function e(){var r,n,i,u,c,d;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.updating=!0,r=s.a.mark((function e(r){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,new Promise((function(e,n){a.nsHttpClient.post("/api/nexopos/v4/update",{file:t.files[r]},{headers:{"X-XSRF-TOKEN":t.xXsrfToken}}).subscribe(e,n)}));case 3:e.sent,e.next=12;break;case 6:return e.prev=6,e.t0=e.catch(0),t.updating=!1,t.error=!0,t.lastErrorMessage=e.t0.message,e.abrupt("return",{v:a.nsSnackBar.error(e.t0.message).subscribe()});case 12:case"end":return e.stop()}}),e,null,[[0,6]])})),e.t0=s.a.keys(t.files);case 3:if((e.t1=e.t0()).done){e.next=11;break}return n=e.t1.value,e.delegateYield(r(n),"t2",6);case 6:if("object"!==o(i=e.t2)){e.next=9;break}return e.abrupt("return",i.v);case 9:e.next=3;break;case 11:if(!(Object.values(t.modules).length>0)){e.next=23;break}t.updatingModule=!0,u=s.a.mark((function e(r){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,new Promise((function(e,n){a.nsHttpClient.post("/api/nexopos/v4/update",{module:t.modules[r]},{headers:{"X-XSRF-TOKEN":t.xXsrfToken}}).subscribe(e,n)}));case 3:e.sent,e.next=12;break;case 6:return e.prev=6,e.t0=e.catch(0),t.updating=!1,t.error=!0,t.lastErrorMessage=e.t0.message,e.abrupt("return",{v:a.nsSnackBar.error(e.t0.message).subscribe()});case 12:case"end":return e.stop()}}),e,null,[[0,6]])})),e.t3=s.a.keys(t.modules);case 15:if((e.t4=e.t3()).done){e.next=23;break}return c=e.t4.value,e.delegateYield(u(c),"t5",18);case 18:if("object"!==o(d=e.t5)){e.next=21;break}return e.abrupt("return",d.v);case 21:e.next=15;break;case 23:t.error=!1,t.updating=!1,document.location=t.returnLink;case 26:case"end":return e.stop()}}),e)})),function(){var t=this,r=arguments;return new Promise((function(n,s){var a=e.apply(t,r);function o(e){i(a,n,s,o,u,"next",e)}function u(e){i(a,n,s,o,u,"throw",e)}o(void 0)}))})()}}},c=r(2),d=Object(c.a)(u,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"container mx-auto flex-auto items-center justify-center flex"},[r("div",{staticClass:"w-full md:w-2/3 lg:w-1/3",attrs:{id:"sign-in-box"}},[e._m(0),e._v(" "),r("div",{staticClass:"my-3 rounded shadow bg-white"},[e._m(1),e._v(" "),r("div",{staticClass:"p-2"},[r("p",{staticClass:"text-center text-sm text-gray-600 py-4"},[e._v("In order to keep NexoPOS running smoothly with updates, we need to proceed to the database migration. In fact you don't need to do any action, just wait until the process is done and you'll be redirected.")]),e._v(" "),e.error?r("div",{staticClass:"border-l-4 text-sm border-red-600 bg-red-200 p-4 text-gray-700"},[r("p",[e._v("\n                        Looks like an error has occured during the update. Usually, giving another shot should fix that. However, if you still don't get any chance.\n                    Please report this message to the support : \n                    ")]),e._v(" "),r("pre",{staticClass:"rounded whitespace-pre-wrap bg-gray-700 text-white my-2 p-2"},[e._v(e._s(e.lastErrorMessage))])]):e._e()]),e._v(" "),r("div",{staticClass:"border-t border-gray-200 p-2 flex justify-between"},[r("div",[e.error?r("button",{staticClass:"rounded bg-red-400 shadow-inner text-white p-2",on:{click:function(t){return e.proceedUpdate()}}},[r("i",{staticClass:"las la-sync"}),e._v(" "),r("span",[e._v("Try Again")])]):e._e()]),e._v(" "),r("div",{staticClass:"flex"},[e.updating?r("button",{staticClass:"rounded bg-blue-400 shadow-inner text-white p-2"},[r("i",{staticClass:"las la-sync animate-spin"}),e._v(" "),e.updatingModule?e._e():r("span",[e._v("Updating...")]),e._v(" "),e.updatingModule?r("span",[e._v("Updating Modules...")]):e._e()]):e._e(),e._v(" "),e.updating?e._e():r("a",{staticClass:"rounded bg-blue-400 shadow-inner text-white p-2",attrs:{href:e.returnLink}},[r("i",{staticClass:"las la-undo"}),e._v(" "),r("span",[e._v("Return")])])])])])])])}),[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"flex justify-center items-center py-6"},[t("h2",{staticClass:"text-6xl font-bold text-transparent bg-clip-text from-blue-500 to-indigo-500 bg-gradient-to-br"},[this._v("NexoPOS")])])},function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"border-b border-gray-200 py-4 flex items-center justify-center"},[t("h3",{staticClass:"text-xl font-bold text-gray-700"},[this._v("Datebase Update")])])}],!1,null,null,null);t.default=d.exports}},[[260,0,1]]]);
//# sourceMappingURL=update.js.map