(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{261:function(e,t,n){e.exports=n(271)},270:function(e,t,n){"use strict";n.r(t);var r=n(7),s=n(0),i=n(11),o={data:function(){return{products:[],isLoading:!1}},computed:{order:function(){return this.$popupParams.order}},mounted:function(){this.loadProducts()},methods:{close:function(){this.$popupParams.reject(!1),this.$popup.close()},loadProducts:function(){var e=this;this.isLoading=!0;var t=this.$popupParams.order.id;s.nsHttpClient.get("/api/nexopos/v4/orders/".concat(t,"/products")).subscribe((function(t){e.isLoading=!1,e.products=t}))},openOrder:function(){this.$popup.close(),this.$popupParams.resolve(this.order)}}},a=n(2),u=Object(a.a)(o,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"shadow-lg bg-white w-6/7-screen md:w-3/5-screen lg:w-2/5-screen h-6/7-screen flex flex-col overflow-hidden"},[n("div",{staticClass:"p-2 flex justify-between text-gray-700 items-center border-b"},[n("h3",{staticClass:"font-semibold"},[e._v("Products â€” "+e._s(e.order.code)+" "),e.order.title?n("span",[e._v("("+e._s(e.order.title)+")")]):e._e()]),e._v(" "),n("div",[n("ns-close-button",{on:{click:function(t){return e.close()}}})],1)]),e._v(" "),n("div",{staticClass:"flex-auto p-2 overflow-y-auto"},[e.isLoading?n("div",{staticClass:"flex-auto relative"},[n("div",{staticClass:"h-full w-full flex items-center justify-center"},[n("ns-spinner")],1)]):e._e(),e._v(" "),e.isLoading?e._e():e._l(e.products,(function(t){return n("div",{key:t.id,staticClass:"item"},[n("div",{staticClass:"flex-col border-b border-blue-400 py-2"},[n("div",{staticClass:"title font-semibold text-gray-700 flex justify-between"},[n("span",[e._v(e._s(t.name)+" (x"+e._s(t.quantity)+")")]),e._v(" "),n("span",[e._v(e._s(e._f("currency")(t.total_price)))])]),e._v(" "),n("div",{staticClass:"text-sm text-gray-600"},[n("ul",[n("li",[e._v("Unit : "+e._s(t.unit.name))])])])])])}))],2),e._v(" "),n("div",{staticClass:"flex justify-end p-2 border-t border-gray-400"},[n("div",{staticClass:"px-1"},[n("div",{staticClass:"-mx-2 flex"},[n("div",{staticClass:"px-1"},[n("ns-button",{attrs:{type:"info"},on:{click:function(t){return e.openOrder()}}},[e._v("Open")])],1),e._v(" "),n("div",{staticClass:"px-1"},[n("ns-button",{attrs:{type:"danger"},on:{click:function(t){return e.close()}}},[e._v("Close")])],1)])])])])}),[],!1,null,null,null).exports,c={props:["orders"],data:function(){return{searchField:""}},name:"ns-pos-pending-order",methods:{previewOrder:function(e){this.$emit("previewOrder",e)},proceedOpenOrder:function(e){this.$emit("proceedOpenOrder",e)},searchOrder:function(){this.$emit("searchOrder",this.searchField)}}},l={components:{nsPosPendingOrders:Object(a.a)(c,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"flex flex-auto flex-col overflow-hidden"},[n("div",{staticClass:"p-1"},[n("div",{staticClass:"flex rounded border-2 border-blue-400"},[n("input",{directives:[{name:"model",rawName:"v-model",value:e.searchField,expression:"searchField"}],staticClass:"p-2 outline-none flex-auto",attrs:{type:"text"},domProps:{value:e.searchField},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchOrder()},input:function(t){t.target.composing||(e.searchField=t.target.value)}}}),e._v(" "),n("button",{staticClass:"w-16 md:w-24 bg-blue-400 text-white",on:{click:function(t){return e.searchOrder()}}},[n("i",{staticClass:"las la-search"}),e._v(" "),n("span",{staticClass:"mr-1 hidden md:visible"},[e._v("Search")])])])]),e._v(" "),n("div",{staticClass:"overflow-y-auto flex flex-auto"},[n("div",{staticClass:"flex p-2 flex-auto flex-col overflow-y-auto"},[e._l(e.orders,(function(t){return n("div",{key:t.id,staticClass:"border-b border-blue-400 w-full py-2"},[n("h3",{staticClass:"text-gray-700"},[e._v(e._s(t.title||"Untitled Order"))]),e._v(" "),n("div",{staticClass:"px-2"},[n("div",{staticClass:"flex flex-wrap -mx-4"},[n("div",{staticClass:"w-full md:w-1/2 px-2"},[n("p",{staticClass:"text-sm text-gray-600"},[n("strong",[e._v("Cashier")]),e._v(" : "+e._s(t.nexopos_users_username))]),e._v(" "),n("p",{staticClass:"text-sm text-gray-600"},[n("strong",[e._v("Register")]),e._v(" : "+e._s(e._f("currency")(t.total)))]),e._v(" "),n("p",{staticClass:"text-sm text-gray-600"},[n("strong",[e._v("Tendered")]),e._v(" : "+e._s(e._f("currency")(t.tendered)))])]),e._v(" "),n("div",{staticClass:"w-full md:w-1/2 px-2"},[n("p",{staticClass:"text-sm text-gray-600"},[n("strong",[e._v("Customer")]),e._v(" : "+e._s(t.nexopos_customers_name))]),e._v(" "),n("p",{staticClass:"text-sm text-gray-600"},[n("strong",[e._v("Date")]),e._v(" : "+e._s(t.created_at))]),e._v(" "),n("p",{staticClass:"text-sm text-gray-600"},[n("strong",[e._v("Type")]),e._v(" : "+e._s(t.type))])])])]),e._v(" "),n("div",{staticClass:"flex justify-end w-full mt-2"},[n("div",{staticClass:"flex rounded-lg overflow-hidden"},[n("button",{staticClass:"text-white bg-green-400 outline-none px-2 py-1",on:{click:function(n){return e.proceedOpenOrder(t)}}},[n("i",{staticClass:"las la-lock-open"}),e._v(" Open")]),e._v(" "),n("button",{staticClass:"text-white bg-blue-400 outline-none px-2 py-1",on:{click:function(n){return e.previewOrder(t)}}},[n("i",{staticClass:"las la-eye"}),e._v(" Products")])])])])})),e._v(" "),0===e.orders.length?n("div",{staticClass:"h-full v-full items-center justify-center flex"},[n("h3",{staticClass:"text-semibold text-gray-700"},[e._v("Nothing to display...")])]):e._e()],2)])])}),[],!1,null,null,null).exports},methods:{searchOrder:function(e){var t=this;s.nsHttpClient.get("/api/nexopos/v4/crud/".concat(this.active,"?search=").concat(e)).subscribe((function(e){t.orders=e.data}))},setActiveTab:function(e){this.active=e,this.loadOrderFromType(e)},openOrder:function(e){POS.loadOrder(e.id),this.$popup.close()},loadOrderFromType:function(e){var t=this;s.nsHttpClient.get("/api/nexopos/v4/crud/".concat(e)).subscribe((function(e){t.orders=e.data}))},previewOrder:function(e){var t=this;new Promise((function(t,n){Popup.show(u,{order:e,resolve:t,reject:n})})).then((function(n){t.proceedOpenOrder(e)}),(function(e){return e}))},proceedOpenOrder:function(e){var t=this;if(POS.products.getValue().length>0)return Popup.show(i.default,{title:"Confirm Your Action",message:"The cart is not empty. Opening an order will clear your cart would you proceed ?",onAction:function(n){n&&t.openOrder(e)}});this.openOrder(e)}},data:function(){return{active:"ns.hold-orders",searchField:"",orders:[]}},mounted:function(){var e=this;this.$popup.event.subscribe((function(t){"click-overlay"===t.event&&e.$popup.close()})),this.loadOrderFromType(this.active)}},d=Object(a.a)(l,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"shadow-lg bg-white w-6/7-screen md:w-3/5-screen lg:w-2/5-screen h-6/7-screen flex flex-col overflow-hidden"},[n("div",{staticClass:"p-2 flex justify-between text-gray-700 items-center border-b"},[n("h3",{staticClass:"font-semibold"},[e._v("Orders")]),e._v(" "),n("div",[n("ns-close-button",{on:{click:function(t){return e.$popup.close()}}})],1)]),e._v(" "),n("div",{staticClass:"p-2 flex overflow-hidden flex-auto"},[n("ns-tabs",{attrs:{active:e.active},on:{changeTab:function(t){return e.setActiveTab(t)}}},[n("ns-tabs-item",{staticClass:"flex flex-col overflow-hidden",attrs:{identifier:"ns.hold-orders",label:"On Hold",padding:"p-0"}},[n("ns-pos-pending-orders",{attrs:{orders:e.orders},on:{searchOrder:function(t){return e.searchOrder(t)},previewOrder:function(t){return e.previewOrder(t)},proceedOpenOrder:function(t){return e.proceedOpenOrder(t)}}})],1),e._v(" "),n("ns-tabs-item",{staticClass:"flex flex-col overflow-hidden",attrs:{identifier:"ns.unpaid-orders",label:"Unpaid",padding:"p-0"}},[n("ns-pos-pending-orders",{attrs:{orders:e.orders},on:{searchOrder:function(t){return e.searchOrder(t)},previewOrder:function(t){return e.previewOrder(t)},proceedOpenOrder:function(t){return e.proceedOpenOrder(t)}}})],1),e._v(" "),n("ns-tabs-item",{staticClass:"flex flex-col overflow-hidden",attrs:{identifier:"ns.partially-paid-orders",label:"Partially Paid",padding:"p-0"}},[n("ns-pos-pending-orders",{attrs:{orders:e.orders},on:{searchOrder:function(t){return e.searchOrder(t)},previewOrder:function(t){return e.previewOrder(t)},proceedOpenOrder:function(t){return e.proceedOpenOrder(t)}}})],1)],1)],1),e._v(" "),n("div",{staticClass:"p-2 flex justify-between border-t bg-gray-200"},[n("div"),e._v(" "),n("div",[n("ns-button",[e._v("close")])],1)])])}),[],!1,null,null,null).exports,p={name:"ns-pos-pending-orders-button",methods:{openPendingOrdersPopup:function(){(new r.a).open(d)}}},f=Object(a.a)(p,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("button",{staticClass:"flex-shrink-0 h-12 flex items-center shadow rounded px-2 py-1 text-sm bg-white text-gray-700",on:{click:function(t){return e.openPendingOrdersPopup()}}},[n("i",{staticClass:"mr-1 text-xl lar la-hand-pointer"}),e._v(" "),n("span",[e._v("Orders")])])}),[],!1,null,null,null);t.default=f.exports},271:function(e,t,n){"use strict";n.r(t),n.d(t,"POS",(function(){return j}));var r=n(64),s=n(7),i=n(0),o={data:function(){return{unitsQuantities:[]}},mounted:function(){var e=this;this.$popup.event.subscribe((function(t){"click-overlay"===t.event&&(e.$popupParams.reject(!1),e.$popup.close())})),this.loadUnits()},methods:{loadUnits:function(){var e=this;i.nsHttpClient.get("/api/nexopos/v4/products/".concat(this.$popupParams.product.$original().id,"/units/quantities")).subscribe((function(t){if(0===t.length)return e.$popup.close(),i.nsSnackBar.error("This product doesn't has any unit defined for selling.").subscribe();e.unitsQuantities=t}))},selectUnit:function(e){this.$popupParams.resolve({unit_quantity_id:e.id,unit_name:e.unit.name,$quantities:function(){return e}}),this.$popup.close()}}},a=n(2),u=Object(a.a)(o,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"bg-white w-2/3-screen lg:w-1/3-screen overflow-hidden flex flex-col"},[e._m(0),e._v(" "),e.unitsQuantities.length>0?n("div",{staticClass:"grid grid-flow-row grid-cols-2 overflow-y-auto"},e._l(e.unitsQuantities,(function(t){return n("div",{key:t.id,staticClass:"hover:bg-gray-200 cursor-pointer border flex-shrink-0 border-gray-200 flex flex-col items-center justify-center",on:{click:function(n){return e.selectUnit(t)}}},[n("div",{staticClass:"h-40 w-full flex items-center justify-center overflow-hidden"},[t.preview_url?n("img",{staticClass:"object-cover h-full",attrs:{src:t.preview_url,alt:t.unit.name}}):e._e(),e._v(" "),t.preview_url?e._e():n("div",{staticClass:"h-40 flex items-center justify-center"},[n("i",{staticClass:"las la-image text-gray-600 text-6xl"})])]),e._v(" "),n("div",{staticClass:"h-0 w-full"},[n("div",{staticClass:"relative w-full flex items-center justify-center -top-10 h-20 py-2 flex-col",staticStyle:{background:"rgb(255 255 255 / 73%)"}},[n("h3",{staticClass:"font-bold text-gray-700 py-2 text-center"},[e._v(e._s(t.unit.name)+" ("+e._s(t.quantity)+")")]),e._v(" "),n("p",{staticClass:"text-sm font-medium text-gray-600"},[e._v(e._s(e._f("currency")(t.sale_price)))])])])])})),0):e._e(),e._v(" "),0===e.unitsQuantities.length?n("div",{staticClass:"h-56 flex items-center justify-center"},[n("ns-spinner")],1):e._e()])}),[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"h-16 flex justify-center items-center flex-shrink-0",attrs:{id:"header"}},[t("h3",{staticClass:"font-bold text-gray-700"},[this._v("Choose Selling Unit")])])}],!1,null,null,null).exports,c=function(){function e(e){this.product=e}return e.prototype.run=function(){var e=this;return new Promise((function(t,n){var r=new s.a({popupClass:"shadow-lg h-1/2-screen w-3/4 xl:w-1/4 bg-white"}),i=e.product;r.open(u,{resolve:t,reject:n,product:i})}))},e}(),l=n(40),d=n(5),p=n.n(d),f=function(){function e(){this.detect()}return e.prototype.detect=function(){window.innerWidth<544?this.screenIs="xs":window.innerWidth>=544&&window.innerWidth<768?this.screenIs="sm":window.innerWidth>=768&&window.innerWidth<992?this.screenIs="md":window.innerWidth>=992&&window.innerWidth<1200?this.screenIs="lg":window.innerWidth>=1200&&(this.screenIs="xg")},e.prototype.is=function(e){return void 0===e?this.screenIs:this.screenIs===e},e}(),h=function(){return(h=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)},v=function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function o(e){try{u(r.next(e))}catch(e){i(e)}}function a(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}u((r=r.apply(e,t||[])).next())}))},b=function(e,t){var n,r,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(s=o.trys,(s=s.length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}},m=window.NsPosDashboardButton=n(273).default,_=window.NsPosPendingOrderButton=n(270).default,y=window.NsPosOrderTypeButton=n(274).default,g=window.NsPosCustomersButton=n(275).default,x=window.NsPosResetButton=n(276).default,w=window.NsAlertPopup=n(53).default,O=window.NsConfirmPopup=n(11).default,C=window.NsPromptPopup=n(32).default,P=window.NsLayawayPopup=n(277).default,j=function(){function e(){this._responsive=new f,this._isSubmitting=!1,this.defaultOrder=function(){return{discount_type:null,title:"",discount:0,discount_percentage:0,subtotal:0,total:0,tendered:0,payment_status:void 0,customer_id:void 0,change:0,total_products:0,shipping:0,tax_value:0,shipping_rate:0,shipping_type:void 0,customer:void 0,type:void 0,products:[],payments:[],addresses:{shipping:void 0,billing:void 0}}},this.header={buttons:{NsPosDashboardButton:m,NsPosPendingOrderButton:_,NsPosOrderTypeButton:y,NsPosCustomersButton:g,NsPosResetButton:x}},this.addToCartQueue=[c,r.a],this.initialize()}return Object.defineProperty(e.prototype,"screen",{get:function(){return this._screen},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"visibleSection",{get:function(){return this._visibleSection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"paymentsType",{get:function(){return this._paymentsType},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"order",{get:function(){return this._order},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"types",{get:function(){return this._types},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"products",{get:function(){return this._products},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"customers",{get:function(){return this._customers},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"settings",{get:function(){return this._settings},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"breadcrumbs",{get:function(){return this._breadcrumbs},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this._isSubmitting=!1,this._products.next([]),this._customers.next([]),this._breadcrumbs.next([]),this.defineCurrentScreen(),this.order.next(this.defaultOrder())},e.prototype.initialize=function(){var e=this;this._products=new l.a([]),this._customers=new l.a([]),this._types=new l.a([]),this._breadcrumbs=new l.a([]),this._screen=new l.a(""),this._paymentsType=new l.a([]),this._visibleSection=new l.a("both"),this._options=new l.a({}),this._order=new l.a(this.defaultOrder()),this._settings=new l.a({}),this.products.subscribe((function(t){e.refreshCart()})),this.types.subscribe((function(t){var n=t.filter((function(e){return e.selected}));if(n.length>0){var r=e.order.getValue();r.type=n[0],e.order.next(r)}})),window.addEventListener("resize",(function(){e._responsive.detect(),e.defineCurrentScreen()})),this.defineCurrentScreen()},e.prototype.defineOptions=function(e){this._options.next(e)},e.prototype.defineCurrentScreen=function(){this._visibleSection.next(["xs","sm"].includes(this._responsive.is())?"grid":"both"),this._screen.next(this._responsive.is())},e.prototype.changeVisibleSection=function(e){["both","cart","grid"].includes(e)&&this._visibleSection.next(e)},e.prototype.addPayment=function(e){if(e.value>0){var t=this._order.getValue();return t.payments.push(e),this._order.next(t),this.computePaid()}return i.nsSnackBar.error("Invalid amount.").subscribe()},e.prototype.removePayment=function(e){if(void 0!==e.id)return i.nsSnackBar.error("Unable to delete a payment attached to the order").subscribe();var t=this._order.getValue(),n=t.payments.indexOf(e);t.payments.splice(n,1),this._order.next(t),i.nsEvent.emit({identifier:"ns.pos.remove-payment",value:e}),this.updateCustomerAccount(e),this.computePaid()},e.prototype.updateCustomerAccount=function(e){if("account-payment"===e.identifier){var t=this.order.getValue().customer;t.account_amount+=e.value,this.selectCustomer(t)}},e.prototype.canProceedAsLaidAway=function(e){var t=this;return new Promise((function(n,r){return v(t,void 0,void 0,(function(){var t,i,o,a;return b(this,(function(u){switch(u.label){case 0:if(t=e.customer.group.minimal_credit_payment,i=e.total*t/100,void 0!==e.expected_payment_date)return[3,4];u.label=1;case 1:return u.trys.push([1,3,,4]),[4,new Promise((function(t,n){s.a.show(P,{order:e,reject:n,resolve:t})}))];case 2:return u.sent(),[3,4];case 3:return o=u.sent(),[2,r(o)];case 4:return e.tendered<i?(a="Before saving the order as laid away, a minimum payment of "+p.a.filter("currency")(i)+" is required",s.a.show(w,{title:"Unable to proceed",message:a}),[2,r({status:"failed",message:a})]):[2,n({status:"success",message:"Can Proceed as layaway"})]}}))}))}))},e.prototype.submitOrder=function(e){var t=this;return void 0===e&&(e={}),new Promise((function(n,r){return v(t,void 0,void 0,(function(){var t,s,o,a,u,c,l=this;return b(this,(function(d){switch(d.label){case 0:return t=h(h({},this.order.getValue()),e),s=t.customer.group.minimal_credit_payment,"hold"===t.payment_status?[3,10]:0!==t.payments.length?[3,5]:"no"!==this.options.getValue().ns_orders_allow_unpaid?[3,1]:[2,r({status:"failed",message:"Please provide a payment before proceeding."})];case 1:if(!(s>0))return[3,5];d.label=2;case 2:return d.trys.push([2,4,,5]),[4,this.canProceedAsLaidAway(t)];case 3:return d.sent(),[3,5];case 4:return o=d.sent(),[2,r(o)];case 5:return t.total>t.tendered?"no"!==this.options.getValue().ns_orders_allow_partial?[3,6]:[2,r({status:"failed",message:"Partially paid orders are disabled."})]:[3,10];case 6:if(!(s>0))return[3,10];d.label=7;case 7:return d.trys.push([7,9,,10]),[4,this.canProceedAsLaidAway(t)];case 8:return d.sent(),[3,10];case 9:return a=d.sent(),[2,r(a)];case 10:return this._isSubmitting?[2,r({status:"failed",message:"An order is currently being processed."})]:(u=this.order.getValue(),c=void 0!==u.id?"put":"post",[2,i.nsHttpClient[c]("/api/nexopos/v4/orders"+(void 0!==u.id?"/"+u.id:""),u).subscribe((function(e){l._isSubmitting=!0,n(e),l.reset()}),(function(e){l._isSubmitting=!1,r(e)}))])}}))}))}))},e.prototype.loadOrder=function(e){var t=this;i.nsHttpClient.get("/api/nexopos/v4/orders/"+e+"/pos").subscribe((function(e){var n=e.products.map((function(e){return e.$original=function(){return e.product},e.$quantities=function(){return e.product.unit_quantities.filter((function(t){return t.id===e.unit_quantity_id}))[0]},e}));e.type=t.types.getValue().filter((function(t){return t.identifier===e.type}))[0],e.addresses={shipping:e.shipping_address,billing:e.billing_address},delete e.shipping_address,delete e.billing_address,t.buildOrder(e),t.buildProducts(n),t.selectCustomer(e.customer)}))},e.prototype.buildOrder=function(e){this.order.next(e)},e.prototype.buildProducts=function(e){this.products.next(e)},e.prototype.printOrder=function(e){if("disabled"===this.options.getValue().ns_pos_printing_enabled_for)return!1;var t=document.createElement("iframe");t.id="printing-section",t.className="hidden",t.src=this.settings.getValue().urls.printing_url.replace("{id}",e),document.body.appendChild(t)},e.prototype.computePaid=function(){var e=this._order.getValue();e.tendered=0,e.payments.length>0&&(e.tendered=e.payments.map((function(e){return e.value})).reduce((function(e,t){return t+e}))),e.tendered>=e.total?e.payment_status="paid":e.tendered>0&&e.tendered<e.total&&(e.payment_status="partially_paid"),e.change=e.tendered-e.total,this._order.next(e)},e.prototype.setPaymentActive=function(e){var t=this._paymentsType.getValue(),n=t.indexOf(e);t.forEach((function(e){return e.selected=!1})),t[n].selected=!0,this._paymentsType.next(t)},e.prototype.definedPaymentsType=function(e){this._paymentsType.next(e)},e.prototype.selectCustomer=function(e){var t=this,n=this.order.getValue();n.customer=e,n.customer_id=e.id,this.order.next(n),i.nsHttpClient.get("/api/nexopos/v4/customers/"+e.id+"/group").subscribe((function(e){n.customer.group=e,t.order.next(n)}))},e.prototype.updateCart=function(e,t){for(var n in t)void 0!==t[n]&&p.a.set(e,n,t[n]);this.order.next(e),this.refreshCart()},e.prototype.refreshCart=function(){var e=this.products.getValue(),t=this.order.getValue(),n=e.map((function(e){return e.total_price}));n.length>0?t.subtotal=n.reduce((function(e,t){return e+t})):t.subtotal=0,"percentage"===t.discount_type&&(t.discount=t.discount_percentage*t.subtotal/100),t.discount>t.subtotal&&(t.discount=t.subtotal,i.nsSnackBar.info("The discount has been set to the cart subtotal").subscribe());var r=e.map((function(e){return e.tax_value}));t.tax_value=0,r.length>0&&(t.tax_value=r.reduce((function(e,t){return e+t}))),t.total=t.subtotal+t.shipping-t.discount,t.products=e,t.total_products=e.length,this.order.next(t)},e.prototype.getStockUsage=function(e,t){var n=this._products.getValue().filter((function(n){return n.product_id===e&&n.unit_quantity_id===t})).map((function(e){return e.quantity}));return n.length>0?n.reduce((function(e,t){return e+t})):0},e.prototype.addToCart=function(e){return v(this,void 0,void 0,(function(){var t,n,r,s,i,o,a,u;return b(this,(function(c){switch(c.label){case 0:for(s in t=new Object,n={product_id:e.id,name:e.name,discount_type:"percentage",discount:0,discount_percentage:0,quantity:0,tax_group_id:e.tax_group_id,tax_value:0,unit_price:0,total_price:0,mode:"normal",$original:function(){return e}},r=[],this.addToCartQueue)r.push(s);i=0,c.label=1;case 1:if(!(i<r.length))return[3,6];o=r[i],c.label=2;case 2:return c.trys.push([2,4,,5]),[4,new this.addToCartQueue[o](n).run(t)];case 3:return a=c.sent(),t=h(h({},t),a),[3,5];case 4:return!1===c.sent()?[2,!1]:[3,5];case 5:return i++,[3,1];case 6:return n=h(h({},n),t),(u=this._products.getValue()).unshift(n),this.refreshProducts(u),this._products.next(u),[2]}}))}))},e.prototype.defineTypes=function(e){this._types.next(e)},e.prototype.removeProduct=function(e){var t=this._products.getValue(),n=t.indexOf(e);t.splice(n,1),this._products.next(t)},e.prototype.updateProduct=function(e,t){var n=this._products.getValue(),r=n.indexOf(e);p.a.set(n,r,h(h({},e),t)),this.refreshProducts(n),this._products.next(n)},e.prototype.refreshProducts=function(e){var t=this;e.forEach((function(e){t.computeProduct(e)}))},e.prototype.computeProduct=function(e){"normal"===e.mode?(e.unit_price=e.$quantities().sale_price,e.tax_value=e.$quantities().sale_price_tax*e.quantity):(e.unit_price=e.$quantities().wholesale_price,e.tax_value=e.$quantities().wholesale_price_tax*e.quantity),["flat","percentage"].includes(e.discount_type)&&"percentage"===e.discount_type&&(e.discount=e.unit_price*e.discount_percentage/100*e.quantity),e.total_price=e.unit_price*e.quantity-e.discount},e.prototype.loadCustomer=function(e){return i.nsHttpClient.get("/api/nexopos/v4/customers/"+e)},e.prototype.defineSettings=function(e){this._settings.next(e)},e.prototype.voidOrder=function(e){var t=this;console.log(e.id),void 0!==e.id?["hold"].includes(e.payment_status)?s.a.show(O,{title:"Order Deletion",message:"The current order will be deleted as no payment has been made so far.",onAction:function(n){n&&i.nsHttpClient.delete("/api/nexopos/v4/orders/"+e.id).subscribe((function(e){i.nsSnackBar.success(e.message).subscribe(),t.reset()}),(function(e){return i.nsSnackBar.error(e.message).subscribe()}))}}):s.a.show(C,{title:"Void The Order",message:"The current order will be void. This will cancel the transaction, but the order won't be deleted. Further details about the operation will be tracked on the report. Consider providing the reason of this operation.",onAction:function(n){!1!==n&&i.nsHttpClient.post("/api/nexopos/v4/orders/"+e.id+"/void",{reason:n}).subscribe((function(e){i.nsSnackBar.success(e.message).subscribe(),t.reset()}),(function(e){return i.nsSnackBar.error(e.message).subscribe()}))}}):i.nsSnackBar.error("Unable to void an unpaid order.").subscribe()},e.prototype.destroy=function(){this._products.unsubscribe(),this._customers.unsubscribe(),this._types.unsubscribe(),this._breadcrumbs.unsubscribe(),this._paymentsType.unsubscribe(),this._screen.unsubscribe(),this._order.unsubscribe(),this._settings.unsubscribe()},e}();window.POS=new j},273:function(e,t,n){"use strict";n.r(t);var r={name:"ns-pos-dashboard-button",methods:{goToDashboard:function(){return document.location=POS.settings.getValue().urls.dashboard_url}}},s=n(2),i=Object(s.a)(r,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("button",{staticClass:"flex-shrink-0 h-12 flex items-center shadow rounded px-2 py-1 text-sm bg-white text-gray-700",on:{click:function(t){return e.goToDashboard()}}},[n("i",{staticClass:"mr-1 text-xl las la-tachometer-alt"}),e._v(" "),n("span",[e._v("Dashboard")])])}),[],!1,null,null,null);t.default=i.exports},274:function(e,t,n){"use strict";n.r(t);var r=n(7),s=n(54),i={name:"ns-pos-delivery-button",methods:{openPendingOrdersPopup:function(){new r.a({primarySelector:"#pos-app",popupClass:"shadow-lg bg-white w-3/5 md:w-2/3 lg:w-2/5 xl:w-2/4"}).open(s.default)}}},o=n(2),a=Object(o.a)(i,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("button",{staticClass:"flex-shrink-0 h-12 flex items-center shadow rounded px-2 py-1 text-sm bg-white text-gray-700",on:{click:function(t){return e.openPendingOrdersPopup()}}},[n("i",{staticClass:"mr-1 text-xl las la-truck"}),e._v(" "),n("span",[e._v("Order Type")])])}),[],!1,null,null,null);t.default=a.exports},275:function(e,t,n){"use strict";n.r(t);var r=n(7),s=n(52),i={name:"ns-pos-customers-button",methods:{openPendingOrdersPopup:function(){(new r.a).open(s.a)}}},o=n(2),a=Object(o.a)(i,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("button",{staticClass:"flex-shrink-0 h-12 flex items-center shadow rounded px-2 py-1 text-sm bg-white text-gray-700",on:{click:function(t){return e.openPendingOrdersPopup()}}},[n("i",{staticClass:"mr-1 text-xl lar la-user-circle"}),e._v(" "),n("span",[e._v("Customers")])])}),[],!1,null,null,null);t.default=a.exports},276:function(e,t,n){"use strict";n.r(t);var r=n(7),s=(n(52),n(11)),i={name:"ns-pos-customers-button",mounted:function(){this.popupCloser()},methods:{popupCloser:n(14).a,reset:function(){r.a.show(s.default,{title:"Confirm Your Action",message:"The current order will be cleared. But not deleted if it's persistent. Would you like to proceed ?",onAction:function(e){e&&POS.reset()}})}}},o=n(2),a=Object(o.a)(i,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("button",{staticClass:"flex-shrink-0 h-12 flex items-center shadow rounded px-2 py-1 text-sm bg-white text-gray-700",on:{click:function(t){return e.reset()}}},[n("i",{staticClass:"mr-1 text-xl  las la-eraser"}),e._v(" "),n("span",[e._v("Reset")])])}),[],!1,null,null,null);t.default=a.exports},277:function(e,t,n){"use strict";n.r(t);var r=n(8),s=n(0);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var u={name:"ns-pos-layaway-popup",data:function(){return{fields:[],formValidation:new r.a,subscription:null}},mounted:function(){var e=this;this.loadFields(),this.subscription=this.$popup.event.subscribe((function(t){["click-overlay","press-esc"].includes(t.event)&&e.close()}))},destroyed:function(){this.subscription.unsubscribe()},methods:{close:function(){this.$popupParams.reject({status:"faield",message:"You must define layaway settings before proceeding."}),this.$popup.close()},updateOrder:function(){var e=this;if(this.fields.forEach((function(t){return e.formValidation.validateField(t)})),!this.formValidation.fieldsValid(this.fields))return s.nsSnackBar.error("Unable to procee the form is not valid").subscribe();var t=this.formValidation.extractFields(this.fields),n=o(o({},this.$popupParams.order),t),r=this.$popupParams,i=r.resolve;r.reject;return POS.order.next(n),this.$popup.close(),i(n)},loadFields:function(){var e=this;s.nsHttpClient.get("/api/nexopos/v4/fields/ns.layaway").subscribe((function(t){e.fields=e.formValidation.createFields(t)}))}}},c=n(2),l=Object(c.a)(u,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"shadow-lg h-95vh md:h-4/6-screen lg:h-3/6-screen w-95vw md:w-4/6-screen lg:w-3/6-screen bg-white flex flex-col"},[n("div",{staticClass:"p-2 border-b flex justify-between items-center"},[n("h3",{staticClass:"font-semibold"},[e._v("Layaway Parameters")]),e._v(" "),n("div",[n("ns-close-button")],1)]),e._v(" "),n("div",{staticClass:"p-2 flex-auto relative"},[0===e.fields.length?n("div",{staticClass:"absolute h-full w-full flex items-center justify-center"},[n("ns-spinner")],1):e._e(),e._v(" "),e._l(e.fields,(function(e,t){return n("ns-field",{key:t,attrs:{field:e}})}))],2),e._v(" "),n("div",{staticClass:"p-2 flex border-t justify-between"},[n("div"),e._v(" "),n("div",{staticClass:"-mx-1 flex"},[n("div",{staticClass:"px-1"},[n("ns-button",{attrs:{type:"danger"},on:{click:function(t){return e.close()}}},[e._v("Cancel")])],1),e._v(" "),n("div",{staticClass:"px-1"},[n("ns-button",{attrs:{type:"info"},on:{click:function(t){return e.updateOrder()}}},[e._v("Save")])],1)])])])}),[],!1,null,null,null);t.default=l.exports}},[[261,0,1]]]);
//# sourceMappingURL=pos-init.js.map